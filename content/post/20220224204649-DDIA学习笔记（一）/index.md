---
title: "DDIA学习笔记（一）"
slug: DDIA学习笔记（一）
date: 2022-02-24T20:46:49+08:00
draft: true
---

<!--more-->

# 前言

很早就买了*Designing Data-Intensive Applications*在书柜吃灰，偶然一天晚上打开看了一下就被内容吸引了，于是每天晚上回家第一件事就是看几节。这里用博客记录下阅读时的一些笔记和感悟。

# Chapter 1. Reliable, Scalable, and Maintainable Applications

针对目前市面上的很多数据库应用，这本书从不同的角度分析这些应用的设计思路以及想要解决的问题，帮助我们更好地利用这些应用解决手头上的问题。

这本书主要关注数据系统以下三个方面：

1. 可靠性：在遇到问题时，系统能否继续正常工作。
2. 可扩展性：随着系统grow，系统自身需要有合理的机制来应对这个增长。
3. 可维护性：不同角色都能高效的使用系统

## 可靠性

## 可扩展性

## 可维护性

# Chapter 2. Data Models and Query Languages

在编写程序时的一个常用的方法是，对软件进行分层，不同层处理不同层的业务。层与层之间通过协议相互交流，而协议其实就是定义了一个数据模型。一个典型的应用结构如下图所示：

{{< tfigure src="images/[ch2]application-layer.jpg" title="" width="70%" class="align-center">}}

本章主要关注第二层结构，介绍一些通用的数据结构。

## Relational Model Versus Document Model

目前最常见的数据模型就是SQL，基于关系模型：数据通过关系组织，而每个关系中由许多无序的元组组成（关系就是表，元组就是行）。除了关系模型外，还有network Model、hierarchical model等。

如今我们通常用面向对象的方式来设计程序，而对象和SQL中的关系不会严格的对应。二者之间通常由一层ORM层进行转换，但是二者之间的不匹配没有完全地解决。例如如果一个简历上有人的基本信息、工作经历、教育经历等信息。其中工作经历和教育经历通常有多个。因此基本信息和这两个经历的关系就是一对多的关系。如果我们用关系模型来存储，通常有三种方案：

1. 传统SQL模型，将三个信息存储到三个表中，使用一个外键来指向user表。
2. 将这些信息以json、xml的形式存储到一行中，使用SQL新特性来检索其中的信息。
3. 将这些信息表示为json、xml，然后以text的形式存储到一行中，这种方法需要程序自己处理里面的数据。

但是其实对于简历这种数据来说，非常容易使用json、xml等格式直接存储，使用document-oriented的数据库就非常合适。

但是json、xml这种文档类型的数据模型也有其缺陷，他们不擅长处理的是多对多或多对一的关系。还是看简历这个例子，假设简历中有base地信息，那么不同的人可能位于不同或相同的城市。在SQL模型中，我们通常使用一个单独的表来存储城市信息，然后在简历表中用一个cityId指向这个城市。在SQL中这么做的好处是，如果城市的名称等信息发生变化，我们只需要修改城市表中对应行的信息即可。在SQL中查询也只需要一次JOIN操作即可。但是对于文档类型的数据模型，如果我们也使用这种引用的方式，那么每次在查询时，都需要进行多次查询才能查到一份简历的完整信息。所以，文档类型的数据模型并不擅长处理JOIN操作。

那么什么时候使用关系型，什么时候使用文档型结构呢？下面是一个对比：

|                | 简单易用                     | 数据模式灵活性                                               | 数据局部性                                                   | 相同点                                      |
| -------------- | ---------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------- |
| 文档型 | 数据中只存在一对多的关系；   | 文档型数据库不强制要求数据的结构；数据结构发生变化时，可以直接写入，但是在代码中需要做兼容；当数据结构不确定是适合使用文档型。 | 文档型结构中通常会将数据存储到一起，因此在查全量数据时可以更好的利用局部性原理。但是如果只查询或修改文档的一小部分，仍需要查询全部的数据，回廊分性能。 | 文档型数据库正在逐渐支持join的查询。        |
| 关系型 | 数据中有多对多、多对一的关系 | 在写入时会严格检车数据的格式；数据结构发生变化时，需要手动调整表结构再修改代码；当数据结构明确时适合关系型。 | 在查询全部数据时，会查询多个索引。在一些关系数据库中，也会使用一些技术将类似的数据放到一起，更好的利用局部性原理。 | 关系型数据库也在逐渐支持对json、xml的支持。 |

